<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>HSP(Highly Sensitive Person) 자가진단 — 27문항</title>
    <style>
        :root{
            --bg:#0f172a;--panel:#111827;--muted:#94a3b8;--text:#e5e7eb;--accent:#38bdf8;--accent2:#22c55e;--warn:#f59e0b;--err:#ef4444;
            --card:#0b1220;--border:#1f2937;
        }
        *{box-sizing:border-box}
        html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui, -apple-system, Segoe UI, Roboto, Pretendard, Apple SD Gothic Neo, Noto Sans KR, sans-serif}
        a{color:var(--accent)}
        .container{max-width:960px;margin:0 auto;padding:24px}
        .card{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));border:1px solid var(--border);border-radius:16px;padding:24px; min-height: 400px; display: flex; flex-direction: column;}
        
        h1{font-size:clamp(22px,3.2vw,32px);margin:0 0 8px}
        .sub{color:var(--muted);margin:0 0 10px}
        .note{color:var(--muted); font-size: 13px; margin: 0 0 20px;}
        
        /* 설문 컨테이너 및 문항 스타일 */
        #quizContainer { flex-grow: 1; position: relative; }
        .item { 
            background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px; 
            margin: 0; min-width: 0; position: absolute; top: 0; left: 0; right: 0; 
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease-in-out;
            display: flex; flex-direction: column; height: 100%;
        }
        .item.active { opacity: 1; pointer-events: auto; position: relative; }
        .qhead{display:flex;gap:15px;align-items:flex-start; margin-bottom: 25px;}
        .qnum{flex:0 0 auto;background:var(--accent);color:#001018;font-weight:700;border-radius:12px;padding:6px 12px; font-size: 1.2em;}
        .qtxt{line-height:1.7;font-weight:600; font-size: 1.2em; flex-grow: 1;}

        /* 답변 버튼 스타일 */
        .opts { 
            margin-top: 20px; 
            display: flex; 
            gap: 15px; 
            justify-content: center;
        }
        .ans-btn {
            cursor: pointer;
            border: 2px solid var(--border);
            border-radius: 14px;
            padding: 15px 25px;
            font-weight: 700;
            font-size: 1.1em;
            background: #0a0f1d;
            color: var(--text);
            transition: all 0.2s;
            flex-basis: 45%;
        }
        .ans-btn:hover {
            border-color: var(--accent);
            background: rgba(56, 189, 248, 0.1);
        }
        .ans-btn.selected-1 { /* '예' 선택 시 */
            background: var(--accent2);
            color: #000;
            border-color: var(--accent2);
        }
        .ans-btn.selected-0 { /* '아니오' 선택 시 */
            background: var(--err);
            color: #fff;
            border-color: var(--err);
        }
        .ans-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* 내비게이션 및 액션 버튼 */
        .nav-actions { display: flex; justify-content: space-between; margin-top: 20px; }
        .nav-actions button { padding: 10px 18px; }
        .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:18px}
        button{cursor:pointer;border:none;border-radius:12px;padding:12px 16px;font-weight:700}
        .primary{background:var(--accent);color:#001018}
        .ghost{background:#0a0f1d;border:1px solid var(--border);color:var(--text)}
        .danger{background:var(--err);color:#fff}
        .muted{color:var(--muted)}

        /* 결과 창 스타일 */
        .result{
            margin-top:22px;background:var(--panel);border:1px solid var(--border);border-radius:16px;
            padding:3.5rem 2.5rem; flex-direction: column; align-items: center; text-align: center;
            display: none; /* 기본적으로 숨김 (공간 차지하지 않음) */
        }
        
        /* 결과 텍스트 크기 확대 (순서 변경에 따라 CSS 변경) */
        .result h3 { /* '결과' */
            font-size: 2.5em; 
            margin: 0 0 15px !important;
            font-weight: 900;
        }
        #interp { /* '성향 정도' 뱃지 (뱃지/성향을 더 크게 강조) */
            font-size: 2.2em; 
            line-height: 1.6;
            margin: 0 0 20px !important;
        }
        #scoreLine { /* '당신의 점수는...' */
            font-size: 1.8em; 
            margin: 0 0 15px !important;
            line-height: 1.5;
        }
        
        .pill{display:inline-block;border:1px solid var(--border);border-radius:999px;padding:6px 10px;margin:4px 6px 0 0;background:#0a0f1d}
        .badge{display:inline-block;border-radius:10px;padding:4px 8px;font-weight:700}
        .ok{background:var(--accent2);color:#06240f}
        .warn{background:var(--warn);color:#2b1d00}
        .err{background:var(--err);color:#fff}
        .progress{height:10px;border-radius:999px;background:#0a0f1d;border:1px solid var(--border);overflow:hidden}
        .bar{height:100%;background:linear-gradient(90deg,var(--accent),#60a5fa);width:0%}
        .footer{margin-top:26px;font-size:13px;color:var(--muted)}
        .req{outline:2px solid var(--err);outline-offset:2px}
        .sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
        
        #btnBlog {
            background: #1DDB16;
            color: #fff;
            border: none;
            padding: 12px 20px;
            font-size: 1.17em;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 20px;
        }
        #btnBlog:hover {
            opacity: 0.9;
        }
        
        /* 설문 완료 시 숨겨질 요소 */
        .hide-on-complete {
            display: none !important;
        }

        @media(max-width: 600px){
            .container{padding: 16px}
            .ans-btn { flex-basis: 100%; }
            .opts { flex-direction: column; }
            .result h3 { font-size: 2em; }
            #scoreLine { font-size: 1.5em; }
            #interp { font-size: 1.2em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="card" role="banner" aria-label="HSP 자가진단 소개">
            <h1>나는 얼마나 예민한 사람일까?</h1>
            <h2>HSP(Highly Sensitive Person) 자가진단 - 27문항</h2>
            <p class="sub">엘레인 아론의 HSP 관련 문헌을 바탕으로 한 자가TEST입니다.</p>
            <p class="note">(자가 점검용으로, <b>공식 임상 진단이 아닙니다</b>.)</p>
            
            <div aria-label="설문 진행도" class="progress" title="진행률">
                <div class="bar" id="progBar"></div>
            </div>
            <p class="hint" id="progText">0 / 27 문항 응답</p>
            
            <div class="actions">
                <button class="danger" id="btnReset" aria-label="응답 초기화">응답 초기화</button>
            </div>
        </header>

        <main class="card" role="main" aria-labelledby="formTitle">
            <h2 id="formTitle" class="sr-only">HSP 27문항 설문</h2>

            <section class="result" id="result" aria-live="polite" aria-atomic="true">
                <h3>결과</h3>
                <p id="interp" style="margin:0 0 6px"></p> 
                <p id="scoreLine" style="margin:0 0 8px"></p>
                <div id="tags" class="muted"></div>
                
                <div class="result-buttons">
                    <button id="btnBlog">너무 예민한 사람들을 위한 공간. Blog 방문하기</button>
                </div>

                <div class="footer">
                    <p><b>참고:</b> 이 도구는 자기 이해를 돕기 위해 문헌을 참고하여, 해당 블로거(forhsp-)가 제작하였습니다. </p>
                    <p class="muted">
                        References: Aron, E. N. (1996). <i>The Highly Sensitive Person</i>; Aron, Aron &amp; Jagiellowicz (2010), <i>PSPR</i>.
                    </p>
                </div>
            </section>
            
            <div id="quizContainer">
                </div>
            
            <div class="nav-actions" id="navActions">
                <button class="ghost" id="btnPrev" style="visibility:hidden">이전</button>
                <button class="primary" id="btnNext">다음</button>
            </div>

        </main>
    </div>

    <script>
        // ---------------------------
        // 데이터: 27 문항 (예=1 / 아니오=0)
        // ---------------------------
        const QUESTIONS = [
            "강한 자극(밝은 빛, 강한 냄새, 거친 옷감, 큰 소리 등)에 쉽게 압도된다.",
            "짧은 시간에 많은 일을 처리해야 하면 불편하거나 스트레스를 느낀다.",
            "카페인 같은 자극 물질에 민감하다.",
            "밝은 빛, 강한 냄새, 거친 옷감, 큰 소리 등이 신경을 거슬리게 한다.",
            "바쁜 날에는 침대나 어두운 방처럼 자극을 줄일 수 있는 공간이 필요하다.",
            "타인의 기분이나 감정에 쉽게 영향을 받는다.",
            "예술이나 음악, 자연에서 깊은 감동을 경험한다.",
            "시끄럽고 혼잡한 환경에서 쉽게 피로해진다.",
            "놀라움(갑작스러운 소리, 예기치 않은 사건)에 과도하게 반응한다.",
            "풍부하고 복잡한 내적 세계(상상, 꿈, 사고)를 가지고 있다.",
            "사소한 디테일이나 변화를 잘 알아차린다.",
            "아이나 동물, 타인의 고통에 강하게 공감한다.",
            "생활이나 일정이 갑작스럽게 변하면 스트레스를 크게 받는다.",
            "실수, 비판, 잔소리에 쉽게 위축된다.",
            "경쟁이나 관찰을 받는 상황에서는 능력을 충분히 발휘하지 못할 때가 많다.",
            "폭력적이거나 잔인한 장면(영화, 뉴스 등)이 오래 마음에 남는다.",
            "의무나 해야 할 일이 쌓이면 쉽게 압도된다.",
            "사회적 상황에서의 긴장이나 갈등이 오래 마음에 남는다.",
            "큰 성과를 내더라도 부담감 때문에 기쁨이 오래 가지 않는다.",
            "식습관, 수면 부족, 과도한 자극이 기분과 몸 상태에 크게 영향을 미친다.",
            "새로운 환경이나 낯선 장소에 적응하는 데 시간이 필요하다.",
            "어린 시절 “너무 예민하다”는 말을 자주 들었다.",
            "타인의 기대나 요구를 잘 의식하고 민감하게 반응한다.",
            "깊은 사색이나 자기 성찰을 자주 한다.",
            "감정의 기복이 큰 편이다.",
            "조용하고 평화로운 환경에서 더 잘 기능한다.",
            "다른 사람들은 대수롭지 않게 여기는 자극에도 신체적·정신적으로 큰 반응을 한다."
        ];

        const TOTAL_QUESTIONS = QUESTIONS.length;
        const STORE_KEY = "hsp27_answers_v9"; // 버전 업데이트
        
        let currentQuestionIndex = 1; 
        let answers = loadAnswers() || {};

        const quizContainer = document.getElementById("quizContainer");
        const navActions = document.getElementById("navActions"); // 탐색 버튼 컨테이너 추가
        const progBar = document.getElementById("progBar");
        const progText = document.getElementById("progText");
        const resultBox = document.getElementById("result");
        const scoreLine = document.getElementById("scoreLine");
        const interp = document.getElementById("interp");
        const tags = document.getElementById("tags");
        const btnPrev = document.getElementById("btnPrev");
        const btnNext = document.getElementById("btnNext");
        const btnBlog = document.getElementById("btnBlog");
        const btnReset = document.getElementById("btnReset"); 

        // --- 데이터 처리 및 UI 업데이트 ---

        function saveAnswers() {
            try { localStorage.setItem(STORE_KEY, JSON.stringify(answers)); } catch(e){}
        }
        function loadAnswers() {
            try {
                const raw = localStorage.getItem(STORE_KEY);
                return raw ? JSON.parse(raw) : null;
            } catch(e){ return null; }
        }

        function getAnsweredCount() {
            return Object.keys(answers).length;
        }

        function updateProgress() {
            const answered = getAnsweredCount();
            const pct = Math.round((answered / TOTAL_QUESTIONS) * 100);
            progBar.style.width = pct + "%";
            progText.textContent = `${answered} / ${TOTAL_QUESTIONS} 문항 응답`;
        }
        
        function updateNavigation() {
            btnPrev.style.visibility = (currentQuestionIndex > 1) ? 'visible' : 'hidden';

            if (currentQuestionIndex < TOTAL_QUESTIONS) {
                btnNext.textContent = '다음';
                btnNext.classList.remove('primary');
                btnNext.classList.add('ghost');
            } else if (currentQuestionIndex === TOTAL_QUESTIONS) {
                 btnNext.textContent = '결과 확인';
                 btnNext.classList.remove('ghost');
                 btnNext.classList.add('primary');
            } else {
                 btnNext.textContent = '결과 확인';
                 btnNext.classList.remove('ghost');
                 btnNext.classList.add('primary');
            }
        }

        function handleAnswer(questionNumber, value) {
            const qName = `q${questionNumber}`;
            answers[qName] = value;
            saveAnswers();
            updateProgress();

            const currentItem = document.getElementById(`item-${questionNumber}`);
            if (currentItem) {
                const buttons = currentItem.querySelectorAll('.ans-btn');
                buttons.forEach(btn => {
                    btn.classList.remove('selected-1', 'selected-0');
                    if (Number(btn.dataset.value) === value) {
                        btn.classList.add(`selected-${value}`);
                    }
                });
            }

            if (questionNumber < TOTAL_QUESTIONS) {
                goToQuestion(questionNumber + 1);
            }
        }

        // --- DOM 생성 및 이동 ---

        function buildForm() {
            QUESTIONS.forEach((q, i) => {
                const idx = i + 1;
                const qName = `q${idx}`;
                
                const wrap = document.createElement("div");
                wrap.className = "item";
                wrap.id = `item-${idx}`;

                const head = document.createElement("div");
                head.className = "qhead";

                const num = document.createElement("div");
                num.className = "qnum";
                num.textContent = `${idx} / ${TOTAL_QUESTIONS}`;

                const qtxt = document.createElement("span");
                qtxt.className = "qtxt";
                qtxt.textContent = q;
                
                head.appendChild(num);
                head.appendChild(qtxt);

                const opts = document.createElement("div");
                opts.className = "opts";

                const btnYes = document.createElement("button");
                btnYes.className = "ans-btn";
                btnYes.textContent = "예 (Yes)";
                btnYes.dataset.value = "1";
                btnYes.addEventListener('click', () => handleAnswer(idx, 1));

                const btnNo = document.createElement("button");
                btnNo.className = "ans-btn";
                btnNo.textContent = "아니오 (No)";
                btnNo.dataset.value = "0";
                btnNo.addEventListener('click', () => handleAnswer(idx, 0));

                opts.appendChild(btnYes);
                opts.appendChild(btnNo);

                wrap.appendChild(head);
                wrap.appendChild(opts);
                quizContainer.appendChild(wrap);

                if (answers[qName] !== undefined) {
                    const value = answers[qName];
                    if (value === 1) {
                         btnYes.classList.add('selected-1');
                    } else if (value === 0) {
                         btnNo.classList.add('selected-0');
                    }
                }
            });
            goToQuestion(1);
        }

        function goToQuestion(index) {
            if (index < 1 || index > TOTAL_QUESTIONS) return;

            // 설문 화면 표시
            resultBox.style.display = 'none';
            quizContainer.style.display = 'block';
            navActions.style.display = 'flex';
            
            const currentItem = document.getElementById(`item-${currentQuestionIndex}`);
            if (currentItem) {
                currentItem.classList.remove('active');
            }

            currentQuestionIndex = index;
            const nextItem = document.getElementById(`item-${currentQuestionIndex}`);
            if (nextItem) {
                nextItem.classList.add('active');
            }
            
            updateNavigation();
        }

        // --- 결과 계산 및 이벤트 핸들러 ---

        function calculate() {
            if (getAnsweredCount() !== TOTAL_QUESTIONS) {
                alert("아직 답변하지 않은 문항이 있습니다! 답변하지 않은 문항으로 이동합니다.");
                
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                    if (answers[`q${i}`] === undefined) {
                        goToQuestion(i);
                        const target = document.getElementById(`item-${i}`);
                        if (target) target.classList.add("req");
                        return;
                    }
                }
                return;
            }

            let score = 0;
            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                score += answers[`q${i}`];
            }

            let band="", badgeClass="ok", text="";
            if (score >= 14){ 
                band=" HSP 성향 강함 "; 
                badgeClass="err";
                text = "민감성이 강하게 나타날 가능성이 높습니다. 자극 관리, 회복 루틴, 환경 조절이 특히 중요합니다.";
            } else if (score >= 10){ 
                band=" 중간 정도 ";
                badgeClass="warn";
                text = "상황에 따라 민감성이 두드러질 수 있습니다. 일상에서 자극/휴식 균형을 점검하세요.";
            } else { 
                band=" HSP 성향 낮음 ";
                badgeClass="ok";
                text = "민감성이 뚜렷하지 않을 수 있습니다. 다만 특정 상황에서 부분적으로 나타날 수 있습니다.";
            }

            // A. 성향 뱃지 (interp 요소 사용 - 글씨 크기 확대됨)
            interp.innerHTML = `<span class="badge ${badgeClass}">${band}</span>`;
            
            // B. 점수 (scoreLine 요소 사용 - 글씨 크기 확대됨)
            scoreLine.innerHTML = `당신의 점수는 <b>${score}점</b> / ${TOTAL_QUESTIONS}점 입니다.`;
            
            // C. 아래 설명 (tags 아래에 작은 글씨로 표시)
            // tags.insertAdjacentHTML('afterend', `<p style="font-size: 0.9em; color: var(--muted); margin-top: 10px;">${text}</p>`);
            // --> 이전 실행에서 추가되었을 수 있으므로 tags 바로 아래에 추가하는 방식을 피하고, 
            // scoreLine 바로 아래에 문단을 직접 구성하는 방식으로 변경합니다.
            // 기존 interp에는 뱃지만 표시했으므로, 뱃지 아래에 점수가 나오고 그 아래에 해석이 나오도록 순서를 맞춥니다.
            
            scoreLine.insertAdjacentHTML('afterend', `<p id="finalInterp" style="font-size: 1.5em; line-height: 1.6; margin: 0 0 20px !important;">${text}</p>`);
            
            // 이전에 추가된 finalInterp가 있다면 제거
            const existingInterp = document.getElementById('finalInterp');
            if(existingInterp) existingInterp.remove();
            
            scoreLine.insertAdjacentHTML('afterend', `<p id="finalInterp" style="font-size: 1.2em; line-height: 1.6; margin: 0 0 20px !important;">${text}</p>`);

            
            tags.innerHTML = [
                '<span class="pill">#HSP</span>', '<span class="pill">#예민한사람</span>', '<span class="pill">#예민하다</span>',
                '<span class="pill">#HSP테스트</span>', '<span class="pill">#민감성테스트</span>', '<span class="pill">#자기이해</span>'
            ].join("");

            // 계산이 완료되면 결과창을 표시하고, 설문/네비게이션을 숨깁니다.
            resultBox.style.display = 'flex';
            quizContainer.style.display = 'none';
            navActions.style.display = 'none';
            
            document.querySelector('.container').scrollIntoView({behavior:"smooth",block:"start"}); 
        }

        function resetAnswers() {
            if (confirm("응답을 모두 지우시겠어요?")) {
                answers = {};
                try { localStorage.removeItem(STORE_KEY); } catch(e){}
                updateProgress();
                
                // 초기화 시 모든 것을 원래대로 표시
                resultBox.style.display = 'none';
                quizContainer.style.display = 'block';
                navActions.style.display = 'flex';
                
                // 결과 해석 텍스트 잔여물 제거
                const existingInterp = document.getElementById('finalInterp');
                if(existingInterp) existingInterp.remove();
                
                const allItems = quizContainer.querySelectorAll('.item');
                allItems.forEach(item => {
                    item.classList.remove('active', 'req');
                    item.querySelectorAll('.ans-btn').forEach(btn => {
                        btn.classList.remove('selected-1', 'selected-0');
                    });
                });
                
                goToQuestion(1);
                window.scrollTo({top:0,behavior:"smooth"});
            }
        }
        
        // --- 이벤트 리스너 ---
        btnPrev.addEventListener('click', () => {
            if (currentQuestionIndex > 1) {
                goToQuestion(currentQuestionIndex - 1);
            }
        });

        btnNext.addEventListener('click', () => {
            if (currentQuestionIndex < TOTAL_QUESTIONS) {
                goToQuestion(currentQuestionIndex + 1);
            } else {
                calculate();
            }
        });
        
        btnBlog.addEventListener('click', () => {
            window.open('https://blog.naver.com/forhsp-', '_blank');
        });

        btnReset.addEventListener("click", resetAnswers);

        // --- 초기화 ---
        buildForm();
        updateProgress();
    </script>
</body>
</html>